[TOC]



# 一项目简介 

本项目依托Flask框架，构建了集图像目标检测与智能对话功能于一体的网站应用。通过整合YOLO目标检测模型和讯飞大模型接口，采用模块化设计理念，全面实现了用户数据管理、检测结果即时展示及智能对话服务的无缝衔接。

## 项目背景 

随着人工智能技术的迅猛发展，目标检测和自然语言处理技术已被广泛应用于安防监控、图像分析和人机交互等领域。例如，在智能家居安全监控领域，人工智能技术凭借数据采集、处理、分析及响应等关键环节，有效实现了对家居设备的安全监控。在图像分析方面，人工智能图像识别技术被应用于人脸识别、烟火识别、车牌识别等，极大地提高了安防监控的效率和准确性。此外，人工智能技术在智能交通系统中扮演着关键角色，利用图像识别技术有效预警并处理交通事件，显著提高了交通管理的智能化程度。本项目旨在结合先进的
YOLO
目标检测模型和讯飞大模型，为用户提供高效、智能的服务平台，满足多样化的应用需求。

## 技术选型 

### Flask

Flask 是一个轻量级的 Python Web 框架，非常适合快速构建和部署 Web 应用。

其模块化设计以及灵活的扩展性能，使得本项目的功能开发更加高效，维护也更为便捷。

### YOLO (You Only Look Once)

YOLO（You Only Look
Once）是一种高效的目标检测模型，能够在实时性和准确性之间实现良好的平衡。

本项目利用 YOLO
模型，对用户上传的图像中的目标进行快速识别，并返回目标类别、位置坐标和置信度等信息。

### 讯飞大模型接口

1.  讯飞大模型提供了强大的自然语言处理能力，可以实现高效的智能对话。

项目采用代理方式接入讯飞大模型接口，为用户提供实时、流畅的交互式聊天体验。

## 主要功能 

### 1.用户管理 

支持用户注册、登录以及个人信息管理。

2.  提供密码修改、邮箱更新等功能，确保用户信息的安全性和灵活性。

### 目标检测

1.  用户可以上传图片，系统调用 YOLO 模型进行目标检测。

    检测完成后，系统将提供目标类别、位置坐标及置信度信息，并将这些数据妥善存储在数据库中，便于用户随时查阅。

### 智能对话

1.  用户只需通过网站界面，即可轻松与讯飞大模型进行实时互动，享受便捷的智能问答服务。

    支持流式响应，提高对话的自然性和连贯性。

### 数据存储与展示

1.  检测结果和相关数据存储在数据库中，并通过前端页面以可视化的方式展示给用户。

    用户可以查看历史记录，包括检测时间、图片文件名和结果详情。

## 项目优势 

1.  **高效目标检测能力：依托先进的YOLO11模型，项目实现了对目标的迅速识别与高精度定位。**

    **智能对话功能：项目通过接入讯飞星火大模型接口，为用户提供了丰富多样的自然语言交互体验。**

    **模块化设计：项目巧妙运用Flask的Blueprint机制，确保了功能的灵活扩展与高效维护。**

    **安全性保障：项目严格实施用户权限控制及数据加密措施，全方位保障用户信息安全。**

# 二项目内容 

## 设计目标

### 项目概述 

该项目旨在为用户提供一站式的 AI
服务，包含智能对话与目标检测两个主要功能。用户通过前端与后端交互，可以实现自然语言处理与图像目标检测，最终提高用户的工作效率与数据分析能力。项目涵盖了用户管理、基于YOLO模型的目标检测功能，以及利用讯飞大模型实现的文本对话功能。借助Flask框架构建的后端系统，结合深度学习和AI模型的应用，该项目旨在全方位提升用户体验。

### 功能目标 

#### 用户注册、登录与个人资料管理

该功能的核心目标是为用户提供便捷的账户管理系统。借助直观易操作的注册与登录界面，用户可以轻松完成身份验证流程，从而畅享个性化服务。

##### 前端设计：

页面采用HTML与CSS技术精心打造，设计简约而不失直观，内置即时输入验证与错误提示功能，确保用户在信息录入过程中能获得即时的反馈。注册及登录页面均设有必填项提示及输入框验证机制，有效降低了用户因操作不当而出错的风险。

##### 数据交互：

用户输入的注册或登录信息将通过 HTTP 请求发送至 Flask
后端进行验证，确保数据的合法性（例如用户名是否重复、密码格式是否符合规范）。

1.  **后端处理：**

后端通过查询 MySQL 数据库验证用户信息的合法性。注册时，通过 SQLAlchemy
插入新用户数据，并为每个用户分配唯一的
ID。登录时，系统验证输入密码与数据库中的哈希值匹配。

2.  **用户状态管理：**

使用 Flask-Login
管理用户的登录状态，确保会话信息持久化，简化用户会话管理。每次用户成功登录后，Flask-Login
会自动在用户浏览器中存储会话信息，使得后端系统能够迅速且准确地识别出当前登录的用户身份。

3.  **安全性：**

密码信息均经过加密处理（例如，采用 bcrypt 或 Werkzeug
提供的先进加密算法），以确保密码的安全存储，有效防止信息泄露。在用户数据提交过程中，后端系统会执行严格的验证程序，有效防范SQL注入、XSS攻击等恶意行为。

4.  **个人资料管理：**

登录后，用户可修改个人信息，如用户名、邮箱及密码。系统会对用户提交的每一项修改内容进行严格的合法性验证，从而确保所有存储的数据均严格遵循既定的规范与标准。

#### 基于 YOLO 的目标检测功能

目标检测功能是该项目的技术核心，结合 YOLOv11
算法，为用户提供高效且精准的图像处理与分析。借助图像分类与目标定位技术，用户能够直观地获取目标检测结果，从而有效优化其工作流程。

##### 算法选择：

我们选择了 YOLOv11
作为目标检测的核心算法，其高效的实时检测能力使得系统能够在各种复杂场景中迅速且准确地识别出目标物体。通过公开的
COCO 数据集进行训练，确保模型的广泛适用性。

##### 后端检测流程：

用户登录后，可通过上传图像进行目标检测。图片通过 HTTP 请求传至 Flask
后端，后端加载已训练的 YOLO
模型进行检测。该模型输出的检测结果详细列出了目标的类别、置信度值以及精确的位置坐标信息。

##### 检测历史保存：

每次检测的结果（包括目标类别、置信度、坐标等）将保存在 MySQL
数据库中，并与用户 ID
关联。用户上传的图像会被安全地存储在服务器上，确保每次检测后，用户都能方便地查看和回顾历史记录。

##### 前端可视化：

前端通过Canvas元素实时地渲染目标检测结果，动态地生成检测框和标签，并绘制在界面上。结果以直观的按钮列表形式展现，用户点击按钮即可查阅特定目标的详细信息。Canvas界面上，目标坐标与标签信息一目了然，进一步点击目标按钮，还能获取更精细的目标图像展示。

#### 讯飞大模型接口代理与文本交互功能

该模块通过整合讯飞星火大模型，实现与用户的自然语言对话。通过流式数据交互技术，系统能够即时响应用户的输入，并迅速返回经过智能自然语言处理的结果。

1.  **后端代理实现：**

Flask 后端充当中间层，接收前端传来的用户文本信息，并将其通过 POST
请求转发至讯飞大模型
API。通过实现流式数据处理（Streaming），讯飞返回的分段数据会实时传递给前端，确保响应快速及时。

2.  **前端显示：**

前端利用 fetch 接口请求流式数据，通过 JavaScript 的 getReader()
方法实时解析数据流，确保用户界面能够即时更新内容。通过 markdown-it.js
库将返回的 Markdown 格式文本转化为 HTML
格式，支持富文本展示（如加粗、斜体、代码块等）。

3.  **功能扩展：**

系统支持连续对话功能，能够保留上下文信息，并根据用户的历史问题智能提供答复。同时，系统对讯飞API的响应进行了全面的异常处理，确保在出错时，前端能够展示清晰友好的错误提示信息。对话界面则采用了聊天气泡设计，旨在提升用户体验。

### 技术目标 

#### 用户管理模块技术实现

用户管理模块的核心目标是保障用户认证与信息管理的稳定与安全。为此，系统采用了Flask框架来提供API接口，并结合SQLAlchemy
ORM执行数据库操作，确保数据的完整性和安全性得到全面保障。

##### 用户注册与登录：

使用 Flask 提供的 API 接口接收前端数据，通过 Flask-Login
管理用户的会话，简化登录态持久化。数据库采用 MySQL，使用 SQLAlchemy ORM
进行数据交互，简化数据库操作并提升代码可维护性。用户密码采用bcrypt等加密算法进行安全存储，有效防止信息泄露。

##### 个人资料管理：

系统提供用户资料修改功能，后端利用Flask框架验证提交内容的合法性，并实时更新数据库中的用户信息。

#### 目标检测模块技术实现

目标检测模块结合深度学习技术与图像处理能力，支持用户上传图片并进行目标检测。系统基于
YOLOv11 模型进行训练与推理，后端通过 Flask 提供 API 接口与前端交互。

##### 模型部署与处理：

YOLOv11模型的权重文件被部署在服务器上，后端通过加载该文件来执行图像的目标检测任务。每次检测后，检测结果以
JSON 格式返回给前端，前端在 Canvas 元素中展示目标信息。

##### 图片上传与存储：

用户上传的图片经由前端HTTP请求发送至后端，后端利用Pillow库解析图片，并将其输入YOLO模型进行推理。图片文件存储在服务器，并通过用户
ID 与检测记录 ID 命名保证唯一性。

#### 讯飞大模型代理模块技术实现

后端通过Flask框架将前端用户输入的对话信息转发至讯飞API，系统支持流式数据传输功能。系统采用流式响应处理，确保用户输入的内容能快速得到反馈。

1.  **流式数据处理：**

通过 Flask 接收用户输入并发送给讯飞
API，后端逐段解析返回的流式数据，并通过前端实时展示。

2.  **数据解析与错误处理：**

利用正则表达式精确提取关键信息，确保返回结果的准确无误；遇到错误时，系统能够向前端提供清晰友好的错误提示。

## 设计方案

### 设计方案 

#### 系统架构设计

本系统采用分层架构，分为前端、后端和数据库三大部分，各部分通过 RESTful
API
进行数据交互。前端负责与用户进行交互，后端则处理逻辑与计算，数据库则用于存储和管理系统数据。系统的整体架构图如下：

plaintext

1.  ![2024-12-12_02-55-45](https://db.xinghai.ink/Typora/17355876124571393.png)

    前端采用HTML、CSS及JavaScript技术栈，构建直观易用的用户界面，并通过AJAX异步通信技术，与后端高效交换数据，如目标检测结果、用户信息等。同时，前端页面借助Vue.js等前端框架，提升动态交互性能，从而确保用户获得出色的使用体验。

    后端基于Flask框架构建，负责处理用户请求，执行包括用户认证、目标检测及调用讯飞大模型接口在内的各类业务逻辑，并与数据库进行无缝交互。Flask框架以其简洁的路由机制及灵活的功能扩展性，助力快速构建多样化的业务模块。后端利用RESTful
    API接口技术，实现了与前端的紧密集成，从而确保了数据能够高效且顺畅地在两者之间传输。

    **数据库：** 数据库部分使用 MySQL，配合 SQLAlchemy
    进行对象关系映射（ORM），简化数据库操作。数据库存储涵盖了用户信息（例如用户名、密码、邮箱等）以及目标检测记录（例如检测图像、目标详情、时间戳等）。在系统设计时，我们深入考虑了数据的检索效率与存储优化需求，通过细致配置索引和事务处理机制，确保了数据的一致性和高效的检索性能。

**数据流与交互过程：**

1.  **前端与后端交互：** 用户通过浏览器访问前端页面，前端通过 HTTP
    请求将数据（如用户输入的图片或对话信息）发送给后端。后端接收请求后，进行处理并返回相应数据（如目标检测结果或对话回答）。

2.  **后端与数据库交互：** 后端通过 SQLAlchemy ORM 与 MySQL
    数据库进行交互，查询或更新用户数据、目标检测结果等。每次请求结束后，后端将数据返回给前端。

3.  **数据库与数据持久化：** 数据库层面，我们选择了 MySQL
    作为存储平台，用于保存所有用户数据和目标检测结果。数据表设计合理，以支持高效的存储与检索。使用索引、事务处理等手段确保系统的稳定性和高性能。

#### 数据库设计

系统的核心数据表设计包括：用户表、目标检测记录表（Cinfo
表）以及一些辅助表（如文件表、日志表等）。以下是主要数据表的设计：

1.  **用户表 (User):**

存储用户的基本信息，包括用户名、邮箱、密码等。

字段设计：

+---------------+---------------------+--------------------------------+
| > **字段名**  | > **类型**          | > **说明**                     |
+===============+=====================+================================+
| > id          | > INT               | > 主键，自动递增，唯一         |
+---------------+---------------------+--------------------------------+
| > username    | > VARCHAR(50)       | > 用户名，唯一，非空           |
+---------------+---------------------+--------------------------------+
| > password    | > VARCHAR(255)      | > 密码（加密存储）             |
+---------------+---------------------+--------------------------------+
| > email       | > VARCHAR(100)      | > 用户邮箱，唯一，非空         |
+---------------+---------------------+--------------------------------+
| > created_at  | > DATETIME          | > 用户注册时间                 |
+---------------+---------------------+--------------------------------+

2.  **目标检测记录表 (Cinfo):**

存储每次目标检测的结果，包括图像文件、检测到的目标信息、置信度、位置等。

字段设计：

------------------------------------------------------------------------
  **字段名**        **类型**               **说明**
----------------- ---------------------- -------------------------------
  id                INT                    主键，自动递增，唯一

  user_id           INT                    外键，关联到用户表的 id

  image_path        VARCHAR(255)           存储图像文件路径

  result_data       TEXT                   JSON 格式的检测结果数据

  created_at        DATETIME               检测结果生成时间

  updated_at        DATETIME               检测记录最后更新时间
  ------------------------------------------------------------------------

#### 用户界面设计

**前端页面设计：**

用户界面设计秉承简洁直观的原则，注重高效交互体验，力求在降低操作复杂度的同时，充分展现丰富的功能特性，提升用户满意度。主要页面包括：

**主页：**检测结果以图像形式嵌入 Canvas
元素中，实时更新，确保用户得到及时反馈。

1.  **个人资料页面：**

用户登录后，可以进入个人资料页面查看和修改个人信息。该页面包括修改用户名、邮箱和密码等功能。系统会对修改内容进行校验，确保信息有效性。

2.  **用户交互流程：**

主页包含项目介绍、登录注册入口，以及功能概述。设计简单直观，用户可以快速找到自己需要的操作入口。主要包括动画效果和动态数据展示，增强用户体验。

3.  **目标检测页面：**

用户上传图像后，将直接进入目标检测页面，该页面不仅允许用户查看上传的图像及其处理结果，还提供了目标筛选和裁剪功能，使用户能够轻松获取所需目标的详细信息。检测结果以列表形式展示，用户点击后可查看目标的位置信息、类别和置信度。

**用户注册/登录：**

用户通过注册页面填写并提交信息，前端验证表单有效性后发送至后端。后端验证成功，信息即存入数据库，用户随即跳转至登录页面。

**目标检测：**

用户在目标检测页面上传图像后，前端通过 AJAX
请求将图像数据发送至后端。后端采用改进的YOLOv5_CA模型进行目标检测，该模型集成了CA注意力机制模块，显著提升了检测精度。实验结果表明，该模型在精确率和召回率方面均优于Faster
RCNN和SSD等传统模型。检测结果通过后端处理后，前端以图像形式在Canvas中展示，用户可以点击目标查看详细信息，从而实现对目标的实时精确识别。

##### 个人资料管理： 

用户在个人资料页面完成信息修改并提交后，前端会迅速将修改请求发送至后端。后端随即对这些信息的合法性进行严格验证，一旦确认无误，便会立即更新数据库中的用户数据。随后，更新后的信息会即时反馈给用户，确保信息的实时性。

#### 技术选型 

Flask 是一个轻量级的 Python Web 框架，尤其适合小型到中型 Web
应用的开发。其模块化设计让 Flask 易于扩展，并且凭借丰富的插件支持，如
Flask-Login 和
Flask-SQLAlchemy，能够迅速满足用户认证和数据库交互等需求。相较于其他框架（例如
Django），Flask
提供了更高的灵活性和简洁性，因此特别适合那些需要高度定制化的项目。

SQLAlchemy 是 Python 的 ORM（对象关系映射）框架，它能够将数据库表映射为
Python 类，从而让数据库操作变得更加直观和简便**。**与直接使用 SQL
查询语句相比，ORM 更易于维护，且支持跨数据库系统（如 MySQL、PostgreSQL
等）。SQLAlchemy使得系统能够便捷地实现数据库迁移和高效的模型管理。

Pillow 是一个功能强大的 Python
图像处理库，支持图像的缩放、裁剪、旋转等操作。在目标检测模块中，Pillow
负责处理用户上传的图像数据，并将其转换成 YOLO
模型推理所需的格式。相较于其他图像处理库，Pillow以其轻量级、易于集成、文档全面且功能强大而著称。

YOLO：\
YOLO（You Only Look
Once）是一个高效的目标检测算法，它不仅在保持较高精度的同时提供实时推理能力，而且通过引入强数据增强技术，YOLOv11版本在速度和精度上都进行了显著的优化。这些改进让YOLOv11在Web应用中的图像目标检测方面表现出色，它能迅速识别图像中的多个物体，并准确提供类别、置信度及位置坐标信息，从而极大地优化了用户体验。例如，在智能监控、自动驾驶和工业检测等领域，YOLOv11能够快速准确地识别不同的对象，并在实时视频分析时保持高帧率下的高精确度。

## 实施过程

### 开发环境搭建

python使用conda创建虚拟环境，确保依赖的库和版本一致，避免版本冲突，版本使用python3.8.19，创建名为public的虚拟环境，并在其中安装Flask、SQLAlchemy、Pillow以及YOLO相关依赖。开发团队遵循敏捷开发原则，采用迭代方式进行功能模块的开发与测试。

系统环境，使用Windows
11进行开发，以确保系统的兼容性和稳定性，同时，我们采用Linux服务器进行部署，并使用VSCode作为开发工具。

### 数据库配置 

在Ubuntu系统中，使用mysql8.0数据库，

![](https://db.xinghai.ink/Typora/17355876292858114.png)

进行配置，在配置文件中配置远程访问，在mysqld.conf配置文件中接收来自当存在具有IP地址的访问时，在MySQL数据库管理系统中，需要将用户配置为通过账号和密码进行登录验证。为此，可设置用户账号（如root），并为其分配密码（例如123456），以确保登录成功。

![](https://db.xinghai.ink/Typora/17355876308832157.png)

创建数据库为flask_server

![](https://db.xinghai.ink/Typora/17355878194089804.png)

通过实施域名解析技术，我们能够将域名host.xinghai.xyz与特定的主机IP地址进行有效绑定，确保用户在访问该域名时能够被准确的导向至相应的服务器。

在开发基于Flask框架的应用程序过程中，与数据库的交互是不可或缺的。为了实现这一目标，在Flask中，我们通常会采用flask_sqlalchemy模块来建立与数据库的连接。通过精确配置连接参数，我们可以将数据库连接信息与Flask应用实例紧密绑定，确保应用能够无缝执行数据库操作。

![](https://db.xinghai.ink/Typora/17355876365904307.png)

配置数据库模型

在项目文件中，我们创建了一个名为model的模块，该模块专门用于存放数据库模型。

此举使得数据库相关的代码得以更加有序地组织和管理，确保了数据库结构的清晰度和易维护性。

在model模块内，我们对数据表的结构及其相互关联进行了详尽的定义，为构建高效且可扩展的数据库系统奠定了坚实的基础。

此外，我们确保了数据库模型具备足够的灵活性，以适应未来潜在的需求变更，同时保持了代码的整洁和一致性。

通过这种做法，我们不仅提升了开发效率，也为项目的长期发展构筑了坚实的基础。

![](https://db.xinghai.ink/Typora/17355876383400571.png)

在这个数据模型设计中，我们定义了两个主要的表格结构，第一个是用户表，它负责存储所有用户的基本信息。第二个表是用于记录和存储用户每次进行检测时产生的历史文件信息的表。这两个表之间为一对多关系，即每个用户ID可关联多个历史记录条目，便于系统追踪和管理用户的历史检测数据。

在完成了模型的设计和定义之后，接下来的步骤是在实际的数据库中创建这些表，以确保数据能够被正确地存储和管理。为了实现这一点，我们使用了Flask框架提供的shell环境。利用Flask
shell执行特定命令与脚本，我们能够轻松地将模型定义转化为数据库中实际存在的表，为后续的数据操作及查询奠定坚实基础。

![](https://db.xinghai.ink/Typora/1735587642221216.png)

表结构如下

![](https://db.xinghai.ink/Typora/17355876475453308.png)

### 用户注册和登录模块 

在处理用户信息时使用flask-login插件，更方便地记录用户登入信息

Flask-login模块的配置如下，在载入login模块之后使用init_app方法绑定当前app应用，使用钩子函数，每当用户访问网站时直接从数据库里获取当前用户的所有信息

![](https://db.xinghai.ink/Typora/17355876547929587.png)

在视图函数中，创建login视图函数，用于处理用户登入信息，如果请求为get则返回登入界面的html，如果为post则获取表单信息，验证用户账号密码的正确性，由于使用了flask-login模型这里登人员需要使用login_user方法就可以了，在登入前退出登入则可以实现用户的切换

![](https://db.xinghai.ink/Typora/17355876605639513.png)

在处理get请求时，返回的html中会带有flask-wtf插件的表单模块，使用表单可以更方便地检验用户信息的合法性，表单模块如下，包括用户名，和密码

![](https://db.xinghai.ink/Typora/1735587665380151.png)

在注册模块中，同样需要对login.html页面返回的数据进行处理。具体地，系统会通过检测表单中的用户名和密码，若这些信息不存在于数据库中，则将其注册到数据库中。

![](https://db.xinghai.ink/Typora/1735587667611524.png)

注册视图函数如下

![](https://db.xinghai.ink/Typora/1735587671441417.png)

### 目标检测模块 

目标检测模型使用了yolov11的算法，通过在网上公开的2400张数据集经过100轮的训练得出的模型，在flask的page页面中写入了目标检测模块的视图函数

![](https://db.xinghai.ink/Typora/1735587674250928.png)

视图函数首先引入了@login_requed，在于用户登入时才能访问，当用户访问时，则在数据库中获取相关历史检测信息，通过flaks模板渲染到detection.html中，让用户直接访问历史检测信息而不用重新检测，然后返回到客户端浏览器

在html中用户通过上传图片到api蓝图的yolo视图函数中进行检测，视图函数如下，获取到，通过Pillow库处理图像数据，结合YOLO目标检测模型执行检测，解析出目标类别、边界框坐标和置信度等信息。检测结果以JSON格式返回客户端，同时使用SQLAlchemy将结果与当前用户信息关联后存入数据库，并将上传的图片保存在服务器指定路径中，实现了目标检测的完整数据处理与存储流程

![](https://db.xinghai.ink/Typora/17355876768215833.png)

前端处理，当在前端通过fetch向后端发送POST请求后，通常会接收到一个JSON格式的响应数据。该数据遵循特定的结构，通常包含目标检测结果，如目标类别（cls）、目标边界框的坐标（xyxy）以及每个目标的置信度（conf）。例如，目标检测数据集的json格式可能包含这些信息，以便于后续处理和分析。前端接收到这些数据后，首先通过then方法解析JSON，将返回数据存储在变量data中。随后，代码会清空之前用于显示目标检测信息的HTML列表元素infoList，以确保新数据能够正确无误地显示，避免与旧数据发生冲突。随后调用了showConvas函数，将图片和后端返回的目标检测数据作为参数传入，用于在Canvas画布上绘制图像和检测结果。

![](https://db.xinghai.ink/Typora/1735587680991823.png)

在showConvas函数中，首先加载用户上传的图像。通过判断fileOrUrl是文件对象还是URL，使用FileReader读取文件数据或直接设置图像的URL路径，最终将图像加载到Image对象中。当图像加载完成后，会调用onload事件处理程序。该程序首先调整Canvas画布的大小，使其与图像的宽高比例一致，以保证图像在画布中的显示不失真。然后，使用drawImage方法将图像绘制在画布上。

![](https://db.xinghai.ink/Typora/173558768274992.png)

当检测到绘制目标检测结果的标志cli\[\'old\'\]为true时，函数进一步处理检测数据。首先，利用cli\[\'oldInfo\'\].xyxy中的边界框坐标数据，通过ctx.strokeRect函数在画布上为每个目标绘制矩形框。在绘制过程中，将边框颜色设定为蓝色，线宽设置为5像素，确保其在图像上清晰可辨。随后，利用fillText方法，在每个目标的边界框顶部显示其类别名称，颜色设为醒目的红色，并采用大号字体，以便用户轻松识别。

同时，此外，该函数还负责将检测结果实时同步至HTML列表infoList中。通过遍历后端反馈的数据，将每个检测目标的信息（包括置信度百分比和类别名称）格式化为按钮元素，并动态地添加到列表中。每个按钮的内容不仅显示检测信息，还绑定了其对应的边界框坐标，以便用户后续操作使用。最后，函数为这些动态生成的按钮添加事件监听器，使用户点击某个按钮时，可以根据存储的边界框信息重新绘制图像并高亮显示对应的目标区域。这种交互设计使得用户可以方便地查看检测结果，同时实现了图像与列表信息的联动展示。

![](https://db.xinghai.ink/Typora/1735587690952132.png)

### 讯飞大模型接口模块 

详细解释代理接口的构建方法，并阐述响应处理的具体步骤。

后端的核心功能是代理请求讯飞大模型API。通过定义Flask路由/xunfei，接收来自前端的POST请求。首先，该路由通过@login_required装饰器保护，确保只有经过身份验证的用户才能访问接口，这与API身份验证中的安全措施相一致，如API密钥、OAuth
2.0、HTTP身份验证方案和JWT身份验证等，从而有效防止未经授权的访问，提高系统的安全性。

API请求转发：

路由处理函数proxy首先定义目标大模型的API地址，即讯飞开放平台的https://spark-api-open.xf-yun.com/v1/chat/completions。这个地址是大模型的主要接口，用于接收上下文和用户输入，然后生成对话回复。

![](https://db.xinghai.ink/Typora/1735587695238835.png)

从前端接收的数据通过request.get_json(）解析，这一步确保获取到的是一个JSON对象，包含了对话上下文、用户输入及一些模型参数（如max_tokens、Stream等）。这些数据会直接转发到讯飞API。

流式数据处理：

由于对话数据可能较大或需要实时生成，后端在向讯飞API发送请求时启用了stream=True选项。此选项允许后端逐步接收讯飞API返回的内容，而不是等到整个响应完成。

响应通过response.iter_lines(decode_unicode=\"utf-8\"）逐行读取，每一行内容可能包含一个JSON结构的结果块。为了提取有效数据，代码使用正则表达式匹配

后端的响应是一个流式数据流，前端通过response.body.getReader(）创建了一个读取器reader，并结合TextDecoder解码器逐块解析流数据。

我们定义了一个异步函数readStream，该函数在循环中读取数据块。一旦数据可用，就通过解码器将二进制数据转换为字符串，并逐步将其拼接到结果变量rr中。

使用markdown-it库解析解码后的文本内容，支持Markdown语法显示（如加粗、代码块等）。解析后的HTML内容被插入到占位符中，逐步替换原先的.形成完整的对话回复。

界面动态更新：

每次收到新数据时，前端都会自动滚动对话区域到底部（通过scrollTop属性），以确保用户能实时看到最新的对话内容。

整个流程结束后，占位符回复会被替换为助手生成的完整内容。

![](https://db.xinghai.ink/Typora/17355876973594277.png)

# 项项目成果 

## 登入界面 

![](https://db.xinghai.ink/Typora/1735587705202801.png)

## 注册页面 

![](https://db.xinghai.ink/Typora/17355877001854095.png)

## Ai对话 

![](https://db.xinghai.ink/Typora/1735587709728476.png)

## 手机适配 

![](https://db.xinghai.ink/Typora/17355877118924234.png)

## 连续对话 

![](https://db.xinghai.ink/Typora/17355878327101882.png)

## 目标检测页面 

![](https://db.xinghai.ink/Typora/17355877175246258.png)

## 检测图片 

![](https://db.xinghai.ink/Typora/17355877203627205.png)

## 查看历史记录 

![](https://db.xinghai.ink/Typora/17355877273371763.png)

## 查看具体检测物体 

![](https://db.xinghai.ink/Typora/17355877326442266.png)

## 适配手机 

![](https://db.xinghai.ink/Typora/17355877382655227.png)

## 我的界面 

![](https://db.xinghai.ink/Typora/17355877435548947.png)

## 修改信息 

![](https://db.xinghai.ink/Typora/17355877487394545.png)

# 四项目总结 

本项目深度融合了YOLOv11目标检测技术与讯飞大模型等先进的大语言模型，致力于打造一个高效、智能的多模态交互系统，并对其实现与优化进行了深入探索。通过对后端算法与前端界面交互的设计，该系统不仅具备图片检测与对话生成两大核心功能，还充分满足了用户对实时检测与高效交互的迫切需求。以下从功能概述、技术实现、项目挑战与优化、成果与意义等方面进行总结。

用户上传图片后，系统利用后端YOLOv11模型对图像中的目标进行检测，返回检测结果，包括目标类别、位置信息和置信度。前端以动态方式将检测结果渲染到图片上，方便用户直观查看。

用户可以通过对话界面与后端大语言模型进行交流，支持上下文记忆与实时响应。前端以动态气泡形式显示用户输入和模型生成的内容，同时支持Markdown渲染，提升展示效果。

## YOLOv11目标检测

图像上传与解析：前端通过fetch将用户上传的图片和检测配置发送至后端。后端接收数据并解析图像文件，通过Pillow库读取图片内容。

接着是模型加载与推理阶段，YOLOv11模型加载完成后，会对图像进行推理分析，最终生成目标检测结果。这些结果包括目标的类别（cls）、精确的边界框坐标（xyxy）以及置信度（conf）信息。

最后，数据存储与返回阶段，检测结果会被存储在数据库中，并被打包成JSON格式的数据结构，以便返回给前端进行后续处理。

前端动态渲染：前端接收检测结果后，通过Canvas绘制检测框和标签，并动态生成目标信息列表，供用户查看和交互。

## 对话生成与代理服务

后端API代理：后端通过Flask框架创建/xunfei路由，将用户请求转发至讯飞大模型API。实现过程中加入了流式处理，利用Response对象逐行返回模型生成的内容，从而实现实时响应。

上下文管理：前端收集对话历史内容，将其作为上下文与用户新输入一并发送至后端，确保对话生成的连贯性。

前端渲染与流式展示技术：通过巧妙地利用Fetch
API和ReadableStream接口，前端能够逐步展示模型所生成的内容，从而极大地优化了用户体验。此外，该技术还通过动态更新HTML元素，实现了对话气泡的流式加载，并支持Markdown格式的文本展示，进一步增强了功能的实用性。

## 数据库与用户管理

为了确保用户能够方便地查看历史记录，每次目标检测的结果及其关联的图片路径都会被妥善地存储到数据库中。

用户权限与安全性保障：我们采用了@login_required装饰器，确保只有登录用户才能访问核心功能。同时，我们还对上传的数据进行了严格的类型和内容验证，进一步提升了系统的安全性。
